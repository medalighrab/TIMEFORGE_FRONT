<app-all-template-front></app-all-template-front>

<!-- ‚úÖ Section Header Professionnelle -->
<header class="business-header">
  <div class="container">
    <div class="row">
      <div class="col-lg-12 text-center">
        <h1 class="display-4">PROJECT MANAGEMENT</h1>
        <p class="lead">Professional Solutions for Your Business Needs</p>
      </div>
    </div>
  </div>
</header>


<!-- ‚úÖ Liste des projets - Version Professionnelle -->
<section class="projects-section">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="section-heading">
          
          <button (click)="scrollToForm()" class="btn btn-scroll-to-form">
            <i class="fas fa-plus"></i> Add New Project
          </button>
          <button [routerLink]="'/calendrie'" class="btn btn-primary">
            Voir le Calendrier
          </button>
          <h2>OUR PROJECTS</h2>
          <h6>We Deliver The Best Projects For Your Business</h6>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-4 col-md-6" *ngFor="let project of projects">
        <div class="project-item">
          <div class="project-thumb">
            <button class="icon-btn edit-btn" (click)="scrollToForm()" title="Modifier le projet">
              <i class="fas fa-edit"></i>
            </button>
            <span class="project-category" [ngClass]="(project)">{{ project.category || 'Project' }}</span>
            
          </div>

          <div class="project-content">
            <h4 class="project-title">{{ project.name }}</h4>
            <p class="project-description">{{ (project.description | slice:0:100) + (project.description.length > 100 ? '...' : '') }}</p>

            <ul class="project-features">
              <li><i class="fas fa-calendar-alt"></i> <strong>Deadline:</strong> {{ project.deadline | date:'mediumDate' }}</li>
              
              <li><i class="fas fa-tasks"></i> <strong>Status:</strong> 
                <span class="badge" [ngClass]="{
                  'badge-primary': project.status === 'Planning',
                  'badge-warning': project.status === 'In Progress',
                  'badge-success': project.status === 'Completed'
                }">{{ project.status }}</span>
              </li>
              <li><i class="fas fa-battery-three-quarters"></i> <strong>Progress:</strong> 
                <div class="progress mt-2">
                  <div class="progress-bar" [ngStyle]="{'width': project.progress + '%'}"></div>
                </div>
              </li>
            </ul>
            <div class="project-actions">
             
              
            </div>
            <div class="project-actions">
              <!-- Bouton D√©tails -->
              <button class="action-button details-button" [routerLink]="['/details-projet', project.projectid]">
                <i class="fas fa-info-circle"></i> D√©tails
              </button>
              
              <!-- Bouton Commentaires -->
              <button class="action-button comments-button" (click)="showProjectDetails(project)">
                <i class="fas fa-comment"></i> Commentaires
              </button>
              
              <!-- Bouton Rapport (toujours visible) -->
              <button class="action-button report-button" [routerLink]="['/rapport-project', project.projectid]">
                <i class="fas fa-file-pdf"></i> Rapport
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ‚úÖ Section Statistiques Professionnelle -->
<section class="stats-section py-5 bg-dark text-white">
  <div class="container">
    <div class="row text-center">
      <div class="col-md-3">
        <div class="stat-item">
          <h3 class="counter"></h3>
          <p>Total Projects</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-item">
          <h3 class="counter"></h3>
          <p>Completed</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-item">
          <h3 class="counter"></h3>
          <p>In Progress</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-item">
          <h3 class="counter"></h3>
          <p>Overdue</p>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- ‚úÖ Formulaire Professionnel avec Reactive Forms -->
<section class="project-form-section"id="projectForm" >
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="form-card">
          <div class="form-header">
            <h3>
              <i class="fas" [ngClass]="isEditing ? 'fa-edit' : 'fa-plus-circle'"></i> 
              {{ isEditing ? 'Edit Project' : 'Create New Project' }}
            </h3>
          </div>

          <form [formGroup]="projectForm" (ngSubmit)="saveProject()" class="project-form">
            <input formControlName="id" type="hidden">

            <div class="form-row">
              <!-- Colonne de gauche -->
              <div class="form-column">
                <div class="form-group">
                  <label for="name">Project Name <span class="required">*</span></label>
                  <div class="input-wrapper">
                    <i class="fas fa-project-diagram input-icon"></i>
                    <input id="name" formControlName="name" class="form-control" 
                           placeholder="Enter project name">
                  </div>
                  <div *ngIf="projectForm.get('name')?.invalid && projectForm.get('name')?.touched" 
                       class="error-message">
                    <i class="fas fa-exclamation-circle"></i> Project name is required (min 3 characters)
                  </div>
                </div>
              </div>

              <!-- Colonne de droite -->
              <div class="form-column">
                <div class="form-group">
                  <label for="deadline">Deadline <span class="required">*</span></label>
                  <div class="input-wrapper">
                    <i class="far fa-calendar-alt input-icon"></i>
                    <input id="deadline" type="date" formControlName="deadline"
                           class="form-control" [min]="today">
                  </div>
                  <div *ngIf="projectForm.get('deadline')?.invalid && projectForm.get('deadline')?.touched" 
                       class="error-message">
                    <i class="fas fa-exclamation-circle"></i> Deadline is required
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group full-width">
              <label for="description">Description <span class="required">*</span></label>
              <div class="input-wrapper">
                <i class="fas fa-align-left input-icon"></i>
                <textarea id="description" formControlName="description" class="form-control" 
                          rows="4" placeholder="Enter project description"></textarea>
              </div>
              <div *ngIf="projectForm.get('description')?.invalid && projectForm.get('description')?.touched" 
                   class="error-message">
                <i class="fas fa-exclamation-circle"></i> Description is required (min 10 characters)
              </div>
            </div>

            <div class="form-actions">
              <button type="button" (click)="resetForm()" class="btn btn-cancel">
                <i class="fas fa-times"></i> Cancel
              </button>
              <button type="submit" [disabled]="projectForm.invalid" class="btn btn-submit">
                <i class="fas" [ngClass]="isEditing ? 'fa-save' : 'fa-check'"></i> 
                {{ isEditing ? 'Confirm Update' : 'Confirm' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ‚úÖ Footer Professionnel -->
<footer class="footer bg-light py-4">
  <div class="container">
    <div class="row">
      <div class="col-md-4">
        <h5>About ProManager</h5>
        <p>A professional project management solution for modern businesses.</p>
      </div>
      <div class="col-md-4">
        <h5>Quick Links</h5>
        <ul class="list-unstyled">
          <li><a href="#">Home</a></li>
          <li><a href="#">Projects</a></li>
          <li><a href="#">Team</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
      </div>
      <div class="col-md-4">
        <h5>Contact Us</h5>
        <address>
          <strong>ProManager Inc.</strong><br>
          123 Business Ave<br>
          New York, NY 10001<br>
          <i class="fas fa-phone"></i> (123) 456-7890<br>
          <i class="fas fa-envelope"></i> 
        </address>
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="col-md-12 text-center">
        <p class="mb-0">&copy; 2023 ProManager. All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>


<!-- ‚úÖ Sidebar d√©tails + commentaires -->
<div class="sidebar" [class.open]="selectedProjectDetails">
  <div class="card details">
    <button class="close-btn" (click)="closeSidebar()">&times;</button>
    <h3>üìÅ D√©tails du projet</h3>
    <div *ngIf="selectedProjectDetails">
      <p><strong>üìå Nom :</strong> {{ selectedProjectDetails.name }}</p>
      <p><strong>üìù Description :</strong> {{ selectedProjectDetails.description }}</p>
      <p><strong>‚è≥ Deadline :</strong> {{ selectedProjectDetails.deadline | date: 'longDate' }}</p>
    </div>
  </div>

  <div class="card comment-section">
    <h4>üí¨ Commentaire</h4>
    <textarea [(ngModel)]="newComment" placeholder="Votre commentaire..."></textarea>
    <button (click)="addComment()">Envoyer</button>
  </div>

  <div class="card comments-list">
    <h4>üóíÔ∏è Commentaires</h4>
    <div *ngFor="let comment of projectComments" class="comment">
      <strong>Post√© par : üë§ {{ comment.name || comment.username || 'Utilisateur inconnu' }}</strong>


      <p>{{ comment.comment }}</p>
      <small>{{ comment.createdAt | date:'short' }}</small>
    </div>
  </div>
  <hr>

<div class="ai-analysis-section mt-3">
  <button class="btn btn-primary w-100" (click)="runAIAnalysis()" [disabled]="isAnalyzing">
    <i class="fas fa-robot"></i> Lancer l'analyse IA
  </button>

  <!-- ‚úÖ Spinner pendant analyse -->
  <div class="text-center my-3" *ngIf="isAnalyzing">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Analyse en cours...</span>
    </div>
    <p>Analyse en cours...</p>
  </div>

  <!-- ‚úÖ Erreur -->
  <div *ngIf="analysisError" class="alert alert-danger mt-2 animate__animated animate__fadeIn">
    {{ analysisError }}
  </div>

  <!-- ‚úÖ R√©sultat -->
  <div *ngIf="analysisResult" class="result-area mt-3 animate__animated animate__fadeIn">

    <h5>üîé R√©sultat de l'analyse</h5>
    <p><strong>Nombre de commentaires analys√©s :</strong> {{ analysisResult.totalComments }}</p>

    <p>
      <strong>Stress d√©tect√© :</strong>
      <span 
      class="badge"
      [ngClass]="{
        'bg-success': analysisResult.stress.toLowerCase().includes('normal') || analysisResult.stress.toLowerCase().includes('d√©tendu'),
        'bg-warning': analysisResult.stress.toLowerCase().includes('tendu') || analysisResult.stress.toLowerCase().includes('pression'),
        'bg-danger': analysisResult.stress.toLowerCase().includes('Tr√®s tendu') || analysisResult.stress.toLowerCase().includes('critique')
      }"
      >
        {{ analysisResult.stress }}
      </span>
    </p>

    <p><strong>R√©sum√© :</strong></p>
    <div class="alert alert-secondary">{{ analysisResult.summary }}</div>

    <!-- ‚úÖ Texte explicatif -->
    <p class="small text-muted">
      Ce r√©sum√© est g√©n√©r√© automatiquement √† partir des commentaires. Le badge indique le niveau global de tension du projet.
    </p>
  </div>
</div>

</div>










